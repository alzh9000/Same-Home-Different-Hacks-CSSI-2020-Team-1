<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <script src="bindings.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>

    <script>
        // Initialize Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyBKETMfUqRr80_qumkfCx92wBOEHOd-C78",
            authDomain: "daince-b612d.firebaseapp.com",
            databaseURL: "https://daince-b612d.firebaseio.com",
            projectId: "daince-b612d",
            storageBucket: "daince-b612d.appspot.com",
            messagingSenderId: "109949199255",
            appId: "1:109949199255:web:92a0d12c5014785ea91ad2"
        });
    </script>
</head>
<body>
    <button id="login" type="button">Login with Google</button>
    <script>
        $(document).ready(() => {
            $("#login").on("click", function(event) {
                console.log("clicked");
                let provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope("profile");
                provider.addScope("email");

                firebase.auth().signInWithPopup(provider)
                    .then(res => {
                        // Set user information
                        localStorage.setItem("name", res.user.displayName);
                        localStorage.setItem("uid", res.user.uid);
                        localStorage.setItem("photo", res.user.photoURL);
                    })
                    .then(() => firebase.auth().currentUser.getIdToken())
                    .then(Authentication.session)
                    .then(res => {
                        if (res.success) window.location.assign("/index.html");
                        else console.error("failed to login");
                    })
                    .catch(err => console.error(err));
            })
        })
    </script>
</body>
</html>